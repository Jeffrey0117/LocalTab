<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ë¶ñÁ™óÂàÜÂâ≤Âô®</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a2e;
      color: #eee;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* È†ÇÈÉ®Â∑•ÂÖ∑Âàó */
    .toolbar {
      background: #16213e;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 16px;
      border-bottom: 1px solid #0f3460;
      flex-shrink: 0;
    }

    .toolbar h1 {
      font-size: 16px;
      font-weight: 500;
      color: #e94560;
      margin-right: 8px;
    }

    .layout-buttons {
      display: flex;
      gap: 6px;
    }

    .layout-btn {
      background: #0f3460;
      border: 1px solid #1a4a7a;
      color: #eee;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
    }

    .layout-btn:hover {
      background: #1a4a7a;
    }

    .layout-btn.active {
      background: #e94560;
      border-color: #e94560;
    }

    .layout-icon {
      display: grid;
      width: 18px;
      height: 14px;
      gap: 1px;
    }

    .layout-icon span {
      background: currentColor;
      border-radius: 1px;
    }

    /* ‰ΩàÂ±ÄÂúñÁ§∫ */
    .icon-row { grid-template-columns: 1fr; grid-template-rows: 1fr 1fr 1fr; }
    .icon-col { grid-template-columns: 1fr 1fr 1fr; grid-template-rows: 1fr; }
    .icon-2x2 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; }
    .icon-left { grid-template-columns: 2fr 1fr; grid-template-rows: 1fr 1fr; }
    .icon-left span:first-child { grid-row: span 2; }
    .icon-right { grid-template-columns: 1fr 2fr; grid-template-rows: 1fr 1fr; }
    .icon-right span:last-child { grid-row: span 2; }
    .icon-top { grid-template-columns: 1fr 1fr; grid-template-rows: 2fr 1fr; }
    .icon-top span:first-child { grid-column: span 2; }
    .icon-tab { grid-template-columns: 1fr; grid-template-rows: 1fr; }

    /* Tab Ê®°ÂºèÊ®£Âºè */
    .tab-layout { display: flex; flex-direction: column; flex: 1; }
    .tab-content { flex: 1; display: flex; flex-direction: column; }
    .tab-bar { background: #16213e; border-top: 1px solid #0f3460; padding: 8px 12px; display: flex; gap: 6px; flex-wrap: wrap; flex-shrink: 0; }
    .tab-item { background: #0f3460; border: 1px solid #1a4a7a; color: #aaa; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; display: flex; align-items: center; gap: 8px; max-width: 200px; transition: all 0.2s; }
    .tab-item:hover { background: #1a4a7a; color: #eee; }
    .tab-item.active { background: #e94560; border-color: #e94560; color: white; }
    .tab-item-index { font-weight: bold; min-width: 16px; }
    .tab-item-url { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .tab-item-close { background: none; border: none; color: inherit; cursor: pointer; padding: 0; font-size: 14px; opacity: 0.7; }
    .tab-item-close:hover { opacity: 1; }

    .url-manager {
      display: flex;
      gap: 8px;
      margin-left: auto;
    }

    .url-input {
      background: #0f3460;
      border: 1px solid #1a4a7a;
      color: #eee;
      padding: 6px 12px;
      border-radius: 6px;
      width: 280px;
      font-size: 12px;
    }

    .url-input:focus {
      outline: none;
      border-color: #e94560;
    }

    .add-btn {
      background: #e94560;
      border: none;
      color: white;
      padding: 6px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
    }

    .add-btn:hover {
      background: #ff6b6b;
    }

    /* ‰∏ªÂÆπÂô® */
    .container {
      flex: 1;
      display: flex;
      overflow: hidden;
      position: relative;
    }

    /* Èù¢Êùø */
    .panel {
      position: relative;
      min-width: 100px;
      min-height: 80px;
      display: flex;
      flex-direction: column;
      background: #16213e;
    }

    .panel-header {
      background: #0f3460;
      padding: 6px 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: #aaa;
      flex-shrink: 0;
    }

    .panel-url {
      flex: 1;
      background: #16213e;
      border: 1px solid #1a4a7a;
      color: #eee;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
    }

    .panel-url:focus {
      outline: none;
      border-color: #e94560;
    }

    .panel-reload {
      background: none;
      border: none;
      color: #888;
      cursor: pointer;
      padding: 4px;
      font-size: 14px;
    }

    .panel-reload:hover {
      color: #e94560;
    }

    .panel-close {
      background: none;
      border: none;
      color: #888;
      cursor: pointer;
      padding: 4px;
      font-size: 12px;
    }

    .panel-close:hover {
      color: #ff6b6b;
    }

    .panel iframe {
      flex: 1;
      border: none;
      background: white;
    }

    /* ÂàÜÂâ≤Á∑ö */
    .divider {
      background: #0f3460;
      flex-shrink: 0;
      position: relative;
      z-index: 10;
    }

    .divider::after {
      content: '';
      position: absolute;
      background: #e94560;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .divider:hover::after,
    .divider.dragging::after {
      opacity: 1;
    }

    .divider-h {
      width: 100%;
      height: 5px;
      cursor: row-resize;
    }

    .divider-h::after {
      left: 0;
      right: 0;
      top: 2px;
      height: 1px;
    }

    .divider-v {
      width: 5px;
      height: 100%;
      cursor: col-resize;
    }

    .divider-v::after {
      top: 0;
      bottom: 0;
      left: 2px;
      width: 1px;
    }

    /* ‰ΩàÂ±ÄÂÆπÂô® */
    .layout-row {
      display: flex;
      flex-direction: column;
      flex: 1;
    }

    .layout-col {
      display: flex;
      flex-direction: row;
      flex: 1;
    }

    /* Á©∫ÁãÄÊÖã */
    .empty-state {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #666;
      font-size: 14px;
    }

    /* Èù¢ÊùøÈÅ∏ÊìáÂô® */
    .panel-selector {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #16213e;
      border: 1px solid #1a4a7a;
      border-radius: 8px;
      padding: 16px;
      z-index: 100;
      display: none;
    }

    .panel-selector.show {
      display: block;
    }

    .panel-selector h3 {
      font-size: 14px;
      margin-bottom: 12px;
      color: #e94560;
    }

    .panel-selector-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .panel-selector-item {
      background: #0f3460;
      border: 1px solid #1a4a7a;
      color: #eee;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }

    .panel-selector-item:hover {
      border-color: #e94560;
    }

    /* Âø´Êç∑ÈçµÊèêÁ§∫ */
    .shortcuts {
      font-size: 11px;
      color: #666;
      display: flex;
      gap: 12px;
    }

    .shortcuts kbd {
      background: #0f3460;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 10px;
    }

    /* Ë®≠ÂÆöÊåâÈàïÁµÑ */
    .config-buttons {
      display: flex;
      gap: 6px;
    }

    .config-btn {
      background: #0f3460;
      border: 1px solid #1a4a7a;
      color: #aaa;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 11px;
      transition: all 0.2s;
    }

    .config-btn:hover {
      background: #1a4a7a;
      color: #eee;
    }

    .config-btn.danger:hover {
      background: #e94560;
      border-color: #e94560;
    }

    /* ÊèêÁ§∫Ë®äÊÅØ */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #16213e;
      border: 1px solid #1a4a7a;
      color: #eee;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 13px;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .toast.show {
      opacity: 1;
    }

    .toast.success {
      border-color: #4ade80;
    }

    .toast.error {
      border-color: #e94560;
    }

    /* Èö±ËóèÁöÑÊ™îÊ°àËº∏ÂÖ• */
    #importInput {
      display: none;
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <h1>ü™ü Ë¶ñÁ™óÂàÜÂâ≤Âô®</h1>
    
    <div class="layout-buttons">
      <button class="layout-btn" data-layout="row" title="‰∏ä‰∏ãÊéíÂàó">
        <div class="layout-icon icon-row"><span></span><span></span><span></span></div>
        ‰∏ä‰∏ã
      </button>
      <button class="layout-btn" data-layout="col" title="Â∑¶Âè≥ÊéíÂàó">
        <div class="layout-icon icon-col"><span></span><span></span><span></span></div>
        Â∑¶Âè≥
      </button>
      <button class="layout-btn" data-layout="2x2" title="2x2 Á∂≤Ê†º">
        <div class="layout-icon icon-2x2"><span></span><span></span><span></span><span></span></div>
        2√ó2
      </button>
      <button class="layout-btn active" data-layout="left" title="Â∑¶ÂÅ¥‰∏ªË¶ñÁ™ó">
        <div class="layout-icon icon-left"><span></span><span></span><span></span></div>
        Â∑¶‰∏ª
      </button>
      <button class="layout-btn" data-layout="right" title="Âè≥ÂÅ¥‰∏ªË¶ñÁ™ó">
        <div class="layout-icon icon-right"><span></span><span></span><span></span></div>
        Âè≥‰∏ª
      </button>
      <button class="layout-btn" data-layout="top" title="È†ÇÈÉ®‰∏ªË¶ñÁ™ó">
        <div class="layout-icon icon-top"><span></span><span></span><span></span></div>
        ‰∏ä‰∏ª
      </button>
    </div>

    <div class="shortcuts">
      <span><kbd>1-9</kbd> ÂàáÊèõÈù¢Êùø</span>
      <span><kbd>R</kbd> ÈáçËºâ</span>
    </div>

    <div class="config-buttons">
      <button class="config-btn" onclick="exportConfig()" title="ÂåØÂá∫ÈÖçÁΩÆ">ÂåØÂá∫</button>
      <button class="config-btn" onclick="triggerImport()" title="ÂåØÂÖ•ÈÖçÁΩÆ">ÂåØÂÖ•</button>
      <button class="config-btn danger" onclick="resetConfig()" title="ÈáçÁΩÆÁÇ∫È†êË®≠">ÈáçÁΩÆ</button>
    </div>

    <div class="url-manager">
      <input type="text" class="url-input" id="urlInput" placeholder="Ëº∏ÂÖ• URLÔºåÂ¶Ç http://localhost:3000">
      <button class="add-btn" onclick="addUrl()">+ Êñ∞Â¢û</button>
    </div>
  </div>

  <div class="container" id="container"></div>
  <div class="toast" id="toast"></div>
  <input type="file" id="importInput" accept=".json" onchange="importConfig(this.files[0])">

  <script>
    // ==================== ÈÖçÁΩÆÁÆ°ÁêÜ ====================
    const STORAGE_KEY = 'localtab_config';
    const CONFIG_VERSION = 1;

    // È†êË®≠ÈÖçÁΩÆ
    const DEFAULT_CONFIG = {
      version: CONFIG_VERSION,
      urls: ['http://localhost:3000/'],
      layout: 'left',
      lastUpdated: null
    };

    // Áï∂ÂâçÁãÄÊÖã
    let urls = [];
    let currentLayout = 'left';
    let panelSizes = {};

    // È°ØÁ§∫ÊèêÁ§∫Ë®äÊÅØ
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast show ' + type;
      setTimeout(() => {
        toast.classList.remove('show');
      }, 2000);
    }

    // ÂÑ≤Â≠òÈÖçÁΩÆÂà∞ localStorage
    function saveConfig() {
      try {
        const config = {
          version: CONFIG_VERSION,
          urls: urls,
          layout: currentLayout,
          lastUpdated: new Date().toISOString()
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(config));
      } catch (e) {
        console.warn('ÁÑ°Ê≥ïÂÑ≤Â≠òÈÖçÁΩÆ:', e);
      }
    }

    // Âæû localStorage ËºâÂÖ•ÈÖçÁΩÆ
    function loadConfig() {
      try {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (stored) {
          const config = JSON.parse(stored);
          if (config.version === CONFIG_VERSION) {
            urls = config.urls || DEFAULT_CONFIG.urls;
            currentLayout = config.layout || DEFAULT_CONFIG.layout;
            return true;
          }
        }
      } catch (e) {
        console.warn('ÁÑ°Ê≥ïËºâÂÖ•ÈÖçÁΩÆ:', e);
      }
      // ‰ΩøÁî®È†êË®≠ÂÄº
      urls = [...DEFAULT_CONFIG.urls];
      currentLayout = DEFAULT_CONFIG.layout;
      return false;
    }

    // ÂåØÂá∫ÈÖçÁΩÆÁÇ∫ JSON Ê™îÊ°à
    function exportConfig() {
      const config = {
        version: CONFIG_VERSION,
        urls: urls,
        layout: currentLayout,
        lastUpdated: new Date().toISOString()
      };
      const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'localtab-config.json';
      a.click();
      URL.revokeObjectURL(url);
      showToast('ÈÖçÁΩÆÂ∑≤ÂåØÂá∫');
    }

    // Ëß∏ÁôºÊ™îÊ°àÈÅ∏Êìá
    function triggerImport() {
      document.getElementById('importInput').click();
    }

    // Âæû JSON Ê™îÊ°àÂåØÂÖ•ÈÖçÁΩÆ
    function importConfig(file) {
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const config = JSON.parse(e.target.result);
          if (!config.urls || !Array.isArray(config.urls)) {
            throw new Error('ÁÑ°ÊïàÁöÑÈÖçÁΩÆÊ†ºÂºè');
          }
          urls = config.urls;
          currentLayout = config.layout || 'left';
          saveConfig();
          renderLayout();
          updateLayoutButtons();
          showToast('ÈÖçÁΩÆÂ∑≤ÂåØÂÖ•');
        } catch (err) {
          showToast('ÂåØÂÖ•Â§±Êïó: ' + err.message, 'error');
        }
      };
      reader.readAsText(file);
      // ÈáçÁΩÆ input ‰ª•‰æøÂÜçÊ¨°ÈÅ∏ÊìáÁõ∏ÂêåÊ™îÊ°à
      document.getElementById('importInput').value = '';
    }

    // ÈáçÁΩÆÁÇ∫È†êË®≠ÈÖçÁΩÆ
    function resetConfig() {
      if (!confirm('Á¢∫ÂÆöË¶ÅÈáçÁΩÆÈÖçÁΩÆÂóéÔºüÊâÄÊúâÂÑ≤Â≠òÁöÑ URL Â∞áË¢´Ê∏ÖÈô§„ÄÇ')) return;
      urls = [...DEFAULT_CONFIG.urls];
      currentLayout = DEFAULT_CONFIG.layout;
      saveConfig();
      renderLayout();
      updateLayoutButtons();
      showToast('Â∑≤ÈáçÁΩÆÁÇ∫È†êË®≠ÈÖçÁΩÆ');
    }

    // Êõ¥Êñ∞‰ΩàÂ±ÄÊåâÈàïÁãÄÊÖã
    function updateLayoutButtons() {
      document.querySelectorAll('.layout-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.layout === currentLayout);
      });
    }

    // ==================== ÂàùÂßãÂåñ ====================
    function init() {
      loadConfig();
      renderLayout();
      setupLayoutButtons();
      setupKeyboard();
    }

    // Ë®≠ÂÆö‰ΩàÂ±ÄÊåâÈàï
    function setupLayoutButtons() {
      document.querySelectorAll('.layout-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.layout-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentLayout = btn.dataset.layout;
          saveConfig(); // Ëá™ÂãïÂÑ≤Â≠ò
          renderLayout();
        });
      });
      updateLayoutButtons();
    }

    // ÈçµÁõ§Âø´Êç∑Èçµ
    function setupKeyboard() {
      document.addEventListener('keydown', (e) => {
        // Â¶ÇÊûúÂú®Ëº∏ÂÖ•Ê°ÜÂÖßÔºåÂøΩÁï•
        if (e.target.tagName === 'INPUT') return;

        // Êï∏Â≠óÈçµÂàáÊèõÈù¢Êùø
        if (e.key >= '1' && e.key <= '9') {
          const index = parseInt(e.key) - 1;
          const panel = document.querySelectorAll('.panel')[index];
          if (panel) {
            panel.querySelector('iframe')?.focus();
          }
        }

        // R ÈáçËºâÁï∂ÂâçÈù¢Êùø
        if (e.key.toLowerCase() === 'r') {
          document.querySelectorAll('.panel iframe').forEach(iframe => {
            iframe.src = iframe.src;
          });
        }
      });
    }

    // Âª∫Á´ãÈù¢Êùø
    function createPanel(url, index) {
      const panel = document.createElement('div');
      panel.className = 'panel';
      panel.innerHTML = `
        <div class="panel-header">
          <span style="color: #e94560; font-weight: bold;">${index + 1}</span>
          <input type="text" class="panel-url" value="${url}" onchange="updateUrl(${index}, this.value)" onkeydown="if(event.key==='Enter')this.blur()">
          <button class="panel-reload" onclick="reloadPanel(${index})" title="ÈáçÊñ∞ËºâÂÖ•">‚Üª</button>
          <button class="panel-close" onclick="removeUrl(${index})" title="ÈóúÈñâ">‚úï</button>
        </div>
        <iframe src="${url}" title="Panel ${index + 1}"></iframe>
      `;
      return panel;
    }

    // Âª∫Á´ãÂàÜÂâ≤Á∑ö
    function createDivider(type, index) {
      const divider = document.createElement('div');
      divider.className = `divider divider-${type}`;
      divider.dataset.index = index;
      
      divider.addEventListener('mousedown', (e) => {
        e.preventDefault();
        startDrag(divider, type);
      });

      return divider;
    }

    // ÊãñÊõ≥Ë™øÊï¥Â§ßÂ∞è
    function startDrag(divider, type) {
      divider.classList.add('dragging');
      const container = divider.parentElement;
      const children = Array.from(container.children).filter(c => c.classList.contains('panel') || c.classList.contains('layout-row') || c.classList.contains('layout-col'));
      const dividerIndex = Array.from(container.children).filter(c => c.classList.contains('divider')).indexOf(divider);
      
      const before = children[dividerIndex];
      const after = children[dividerIndex + 1];
      
      if (!before || !after) return;

      const isVertical = type === 'v';
      const containerRect = container.getBoundingClientRect();
      const totalSize = isVertical ? containerRect.width : containerRect.height;

      const startPos = isVertical ? event.clientX : event.clientY;
      const beforeSize = isVertical ? before.offsetWidth : before.offsetHeight;
      const afterSize = isVertical ? after.offsetWidth : after.offsetHeight;

      function onMove(e) {
        const currentPos = isVertical ? e.clientX : e.clientY;
        const delta = currentPos - startPos;
        
        const newBeforeSize = Math.max(100, beforeSize + delta);
        const newAfterSize = Math.max(100, afterSize - delta);
        
        const totalNew = newBeforeSize + newAfterSize;
        before.style.flex = `${newBeforeSize / totalNew}`;
        after.style.flex = `${newAfterSize / totalNew}`;
      }

      function onUp() {
        divider.classList.remove('dragging');
        document.removeEventListener('mousemove', onMove);
        document.removeEventListener('mouseup', onUp);
      }

      document.addEventListener('mousemove', onMove);
      document.addEventListener('mouseup', onUp);
    }

    // Ê∏≤Êüì‰ΩàÂ±Ä
    function renderLayout() {
      const container = document.getElementById('container');
      container.innerHTML = '';

      if (urls.length === 0) {
        container.innerHTML = '<div class="empty-state">ÈªûÊìäÂè≥‰∏äËßí„Äå+ Êñ∞Â¢û„ÄçÂä†ÂÖ• URL</div>';
        return;
      }

      switch (currentLayout) {
        case 'row':
          renderRowLayout(container);
          break;
        case 'col':
          renderColLayout(container);
          break;
        case '2x2':
          render2x2Layout(container);
          break;
        case 'left':
          renderLeftLayout(container);
          break;
        case 'right':
          renderRightLayout(container);
          break;
        case 'top':
          renderTopLayout(container);
          break;
      }
    }

    // ‰∏ä‰∏ãÊéíÂàó
    function renderRowLayout(container) {
      const wrapper = document.createElement('div');
      wrapper.className = 'layout-row';
      wrapper.style.cssText = 'display: flex; flex-direction: column; flex: 1;';
      
      urls.forEach((url, i) => {
        if (i > 0) wrapper.appendChild(createDivider('h', i - 1));
        const panel = createPanel(url, i);
        panel.style.flex = '1';
        wrapper.appendChild(panel);
      });
      
      container.appendChild(wrapper);
    }

    // Â∑¶Âè≥ÊéíÂàó
    function renderColLayout(container) {
      const wrapper = document.createElement('div');
      wrapper.className = 'layout-col';
      wrapper.style.cssText = 'display: flex; flex-direction: row; flex: 1;';
      
      urls.forEach((url, i) => {
        if (i > 0) wrapper.appendChild(createDivider('v', i - 1));
        const panel = createPanel(url, i);
        panel.style.flex = '1';
        wrapper.appendChild(panel);
      });
      
      container.appendChild(wrapper);
    }

    // 2x2 Á∂≤Ê†º
    function render2x2Layout(container) {
      const wrapper = document.createElement('div');
      wrapper.style.cssText = 'display: flex; flex-direction: column; flex: 1;';

      // ‰∏äÊéí
      const topRow = document.createElement('div');
      topRow.style.cssText = 'display: flex; flex: 1;';
      
      if (urls[0]) {
        const p = createPanel(urls[0], 0);
        p.style.flex = '1';
        topRow.appendChild(p);
      }
      if (urls[1]) {
        topRow.appendChild(createDivider('v', 0));
        const p = createPanel(urls[1], 1);
        p.style.flex = '1';
        topRow.appendChild(p);
      }
      wrapper.appendChild(topRow);

      // ÂàÜÂâ≤Á∑ö
      if (urls.length > 2) {
        wrapper.appendChild(createDivider('h', 0));
        
        // ‰∏ãÊéí
        const bottomRow = document.createElement('div');
        bottomRow.style.cssText = 'display: flex; flex: 1;';
        
        if (urls[2]) {
          const p = createPanel(urls[2], 2);
          p.style.flex = '1';
          bottomRow.appendChild(p);
        }
        if (urls[3]) {
          bottomRow.appendChild(createDivider('v', 1));
          const p = createPanel(urls[3], 3);
          p.style.flex = '1';
          bottomRow.appendChild(p);
        }
        wrapper.appendChild(bottomRow);
      }

      container.appendChild(wrapper);
    }

    // Â∑¶ÂÅ¥‰∏ªË¶ñÁ™ó
    function renderLeftLayout(container) {
      const wrapper = document.createElement('div');
      wrapper.style.cssText = 'display: flex; flex: 1;';

      // Â∑¶ÂÅ¥‰∏ªÈù¢Êùø
      if (urls[0]) {
        const main = createPanel(urls[0], 0);
        main.style.flex = '2';
        wrapper.appendChild(main);
      }

      // Âè≥ÂÅ¥Â†ÜÁñä
      if (urls.length > 1) {
        wrapper.appendChild(createDivider('v', 0));
        
        const sidebar = document.createElement('div');
        sidebar.style.cssText = 'display: flex; flex-direction: column; flex: 1;';
        
        urls.slice(1).forEach((url, i) => {
          if (i > 0) sidebar.appendChild(createDivider('h', i));
          const p = createPanel(url, i + 1);
          p.style.flex = '1';
          sidebar.appendChild(p);
        });
        
        wrapper.appendChild(sidebar);
      }

      container.appendChild(wrapper);
    }

    // Âè≥ÂÅ¥‰∏ªË¶ñÁ™ó
    function renderRightLayout(container) {
      const wrapper = document.createElement('div');
      wrapper.style.cssText = 'display: flex; flex: 1;';

      // Â∑¶ÂÅ¥Â†ÜÁñä
      if (urls.length > 1) {
        const sidebar = document.createElement('div');
        sidebar.style.cssText = 'display: flex; flex-direction: column; flex: 1;';
        
        urls.slice(1).forEach((url, i) => {
          if (i > 0) sidebar.appendChild(createDivider('h', i));
          const p = createPanel(url, i + 1);
          p.style.flex = '1';
          sidebar.appendChild(p);
        });
        
        wrapper.appendChild(sidebar);
        wrapper.appendChild(createDivider('v', 0));
      }

      // Âè≥ÂÅ¥‰∏ªÈù¢Êùø
      if (urls[0]) {
        const main = createPanel(urls[0], 0);
        main.style.flex = '2';
        wrapper.appendChild(main);
      }

      container.appendChild(wrapper);
    }

    // È†ÇÈÉ®‰∏ªË¶ñÁ™ó
    function renderTopLayout(container) {
      const wrapper = document.createElement('div');
      wrapper.style.cssText = 'display: flex; flex-direction: column; flex: 1;';

      // È†ÇÈÉ®‰∏ªÈù¢Êùø
      if (urls[0]) {
        const main = createPanel(urls[0], 0);
        main.style.flex = '2';
        wrapper.appendChild(main);
      }

      // Â∫ïÈÉ®‰∏¶Êéí
      if (urls.length > 1) {
        wrapper.appendChild(createDivider('h', 0));
        
        const bottomRow = document.createElement('div');
        bottomRow.style.cssText = 'display: flex; flex: 1;';
        
        urls.slice(1).forEach((url, i) => {
          if (i > 0) bottomRow.appendChild(createDivider('v', i));
          const p = createPanel(url, i + 1);
          p.style.flex = '1';
          bottomRow.appendChild(p);
        });
        
        wrapper.appendChild(bottomRow);
      }

      container.appendChild(wrapper);
    }

    // Êñ∞Â¢û URL
    function addUrl() {
      const input = document.getElementById('urlInput');
      let url = input.value.trim();

      if (!url) return;

      // Ëá™ÂãïË£úÂÖ®ÂçîË≠∞
      if (!url.startsWith('http://') && !url.startsWith('https://')) {
        url = 'http://' + url;
      }

      urls.push(url);
      input.value = '';
      saveConfig(); // Ëá™ÂãïÂÑ≤Â≠ò
      renderLayout();
    }

    // Êõ¥Êñ∞ URL
    function updateUrl(index, newUrl) {
      if (!newUrl.startsWith('http://') && !newUrl.startsWith('https://')) {
        newUrl = 'http://' + newUrl;
      }
      urls[index] = newUrl;
      saveConfig(); // Ëá™ÂãïÂÑ≤Â≠ò
      const iframe = document.querySelectorAll('.panel iframe')[index];
      if (iframe) iframe.src = newUrl;
    }

    // ÁßªÈô§ URL
    function removeUrl(index) {
      urls.splice(index, 1);
      saveConfig(); // Ëá™ÂãïÂÑ≤Â≠ò
      renderLayout();
    }

    // ÈáçËºâÈù¢Êùø
    function reloadPanel(index) {
      const iframe = document.querySelectorAll('.panel iframe')[index];
      if (iframe) iframe.src = iframe.src;
    }

    // Enter ÈçµÊñ∞Â¢û
    document.getElementById('urlInput').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') addUrl();
    });

    // ÂïüÂãï
    init();
  </script>
</body>
</html>